#!/bin/sh
INPUT=$(cat); CMD=$(echo "$INPUT" | grep -oE '"command"[[:space:]]*:[[:space:]]*"[^"]*"' | head -1 | sed 's/.*"command"[[:space:]]*:[[:space:]]*"//;s/"$//'); AL=$(git config --get user.allowed-branch 2>/dev/null); if [ -z "$AL" ]; then exit 0; fi; case "$CMD" in git\ commit*|git\ push*) BR=$(git symbolic-ref --short HEAD 2>/dev/null); if [ "$BR" != "$AL" ]; then echo "BLOCKED: You must use branch: $AL (current: $BR)" >&2; exit 2; fi;; esac; exit 0