#!/bin/sh
INPUT=$(cat); CMD=$(echo "$INPUT" | grep -o '"command":"[^"]*"' | head -1 | sed 's/"command":"//;s/"$//'); case "$CMD" in git\ commit*|git\ push*) BR=$(git symbolic-ref --short HEAD 2>/dev/null); AL=$(git config --get user.allowed-branch); case "$BR" in main|develop) echo "BLOCKED: Cannot commit/push to $BR"; exit 2;; esac; if [ -n "$AL" ] && [ "$BR" != "$AL" ]; then echo "BLOCKED: Use $AL not $BR"; exit 2; fi;; esac; true